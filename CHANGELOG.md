# Epistola Suite Changelog

## [Unreleased]

### Added

- **Asynchronous Document Generation API**: Comprehensive async document generation system using Spring Batch
  - Single document generation with immediate job ID response (202 Accepted)
  - Batch document generation supporting multiple documents in one request
  - Job status tracking with real-time progress monitoring
  - Document download and listing endpoints
  - Job cancellation for pending/in-progress jobs
  - Automatic cleanup of expired jobs and old documents
  - PostgreSQL BYTEA storage for generated PDFs (future migration path to S3/MinIO)
  - Spring Batch integration with chunk-oriented processing (10 items per transaction)
  - Fault tolerance: batch processing continues on partial failures
  - Multi-tenant isolation with proper security
  - REST API endpoints under `/v1/tenants/{tenantId}/documents/`
  - Configurable retention: jobs (7 days), documents (30 days)
  - **Note**: Currently has compilation errors with Spring Batch imports that need fixing
- **Page Header Block**: New block type to display repeating headers on every PDF page
  - Frontend: Visual component with blue styling and drag-drop child block support
  - Backend: `PageHeaderBlock` model with dedicated `PageHeaderEventHandler`
  - Appears in block palette with PanelTop icon
  - Header automatically repeats on every page using `PdfDocumentEvent.END_PAGE` events
  - Supports any child block types (text, images, tables, loops, conditionals)
  - Supports dynamic template variables and expressions
  - Fully backward compatible - existing templates work unchanged
- **Page Footer Block**: New block type to display repeating footers on every PDF page
  - Frontend: Visual component matching page header pattern with drag-drop child block support
  - Backend: `PageFooterBlock` model with dedicated `PageFooterEventHandler`
  - Appears in block palette with PanelBottom icon
  - Footer automatically repeats at bottom of every page using correct iText positioning (36pt margin from bottom edge)
  - Supports any child block types (text, images, tables, loops, conditionals)
  - Supports dynamic template variables and expressions
  - Fully backward compatible - existing templates work unchanged
  - Architecture: Separate event handlers for header and footer with independent PdfCanvas objects for proper isolation
- **Page Break Block**: New block type to force content onto a new page in PDF generation
  - Frontend: Visual component with horizontal lines and "Page Break" label
  - Backend: `PageBreakBlock` model and `PageBreakBlockRenderer` using iText's `AreaBreak()`
  - Appears in block palette with Minus icon
  - Fully backward compatible - existing templates work unchanged

### Changed

- **BREAKING**: Spring Batch now enabled for async document generation
  - Previously disabled via `spring.batch.job.enabled: false` in application-local.yaml
  - Now enabled to support document generation jobs
  - Requires database migration V5 for Spring Batch tables
- **BREAKING**: Reorganized template-related packages into aggregate root structure
  - Moved `variants/` package into `templates/commands/variants/` and `templates/queries/variants/`
  - Moved `versions/` package into `templates/commands/versions/` and `templates/queries/versions/`
  - Moved `activations/` package into `templates/commands/activations/` and `templates/queries/activations/`
  - Moved domain models to `templates/model/`
  - All imports from `app.epistola.suite.variants.*` must be updated to `app.epistola.suite.templates.*`
  - All imports from `app.epistola.suite.versions.*` must be updated to `app.epistola.suite.templates.*`
  - All imports from `app.epistola.suite.activations.*` must be updated to `app.epistola.suite.templates.*`
  - No database or API contract changes - only code organization
  - Clarifies that activation is part of the template deployment lifecycle, not environment configuration
  - Improves clarity of aggregate boundaries and domain model
- **API Architecture**: Refactored V1 API into focused controllers for better
  separation of concerns
  - Split monolithic V1ApiController (713 lines) into two controllers
  - EpistolaTenantApi: Handles tenant and environment operations (10 operations)
  - EpistolaTemplateApi: Handles template lifecycle operations (20 operations)
  - Uses OpenAPI Generator's `useTags` configuration to generate separate
    interfaces per tag
  - Controllers implement multiple tag-based interfaces: TenantsApi,
    EnvironmentsApi, TemplatesApi, VariantsApi, VersionsApi
  - Extracted shared DTO mappers and helpers to `api.v1.shared` package
  - No breaking changes to API contracts or client code
- **PDF Header/Footer Rendering**: Fixed positioning bug by using separate event handlers
  - Reverted from unified `PageHeaderFooterEventHandler` back to separate handlers
  - Root cause: Shared PdfCanvas between header and footer caused positioning conflicts in iText
  - Solution: `PageHeaderEventHandler` and `PageFooterEventHandler` with independent canvases
  - Each handler creates its own content stream for proper isolation
  - Header and footer now render correctly at top and bottom respectively
- **Demo Tenant Management**: Replaced simple existence check with version-tracked demo loader
  - New `app_metadata` table for application-level configuration
  - Demo tenant is now recreated only when version changes (bump `DEMO_VERSION` constant)
  - Demo loading can be disabled via `epistola.demo.enabled: false` configuration
  - Eliminates need to manually delete demo tenant for testing updates
  - Foundation for future deployment package management

### Fixed

- **Template Editor Navigation**: Back button in template editor now navigates to the template detail page instead of the templates list
  - Changed back button URL from `/tenants/{tenantId}/templates` to `/tenants/{tenantId}/templates/{templateId}`
  - Updated button text from "Back to Templates" to "Back to Template"
  - Improves UX by returning users to the specific template they were viewing
- **Template Model**: Simplified `documentStyles` to be consistently non-nullable across frontend and backend
  - Backend: `documentStyles: DocumentStyles = DocumentStyles()` (non-nullable with default)
  - Frontend: `documentStyles: DocumentStyles` (non-nullable)
  - Frontend: Removed unnecessary `normalizeTemplate()` function - no longer needed with consistent non-null contract
  - Impact: Cleaner API contract; templates always have documentStyles object; any dev database templates with null values will fail to load (acceptable since not in production)
- **Template Editor - Loop Block**: Fixed incorrect validation error for literal array expressions
  - Issue: Entering literal arrays like `[]` or `[1,2,3]` in loop expressions showed "Expression must resolve to an array" warning
  - Root cause: Loop validation used simple dot-notation path lookup instead of expression evaluation
  - Solution: Changed `LoopBlock` component to use `useEvaluator` hook for proper expression evaluation
  - Impact: Literal arrays, JSONata queries, and complex expressions now validate correctly in loops
- **PDF Generation**: Fixed iText7 error "Pdf indirect object belongs to other PDF document" when using bold/italic text
  - Root cause: Font objects were cached at class/object level and reused across multiple PDF documents
  - Solution: Implemented `FontCache` class to scope fonts per PDF document
  - Affected files: `TipTapConverter`, `StyleApplicator`, all block renderers
  - Impact: Multiple PDF renders (e.g., preview multiple templates) now work correctly

### Added
- **Enhanced Demo Loader with Realistic Template Content**
  - Demo templates now loaded from JSON files in `resources/demo/templates/`
  - Complete template definitions include: data model (JSON Schema), data examples, and visual layout (blocks, styles)
  - New `TemplateDefinition` data class for declarative template loading
  - Added production-ready Invoice Template with 3 example data sets
  - Invoice template demonstrates all block types: columns, containers, tables, loops, conditionals, expressions
  - DemoLoader now creates complete templates (metadata + visual content) in 4 steps:
    1. Create template metadata
    2. Update with data model and examples
    3. Get default variant
    4. Update draft with visual content
  - Bumped `DEMO_VERSION` to 2.0.1 to trigger reload
  - Foundation for future template marketplace/package system
  - Expression nodes in TipTap content require `"isNew": false` attribute to render correctly
  - See `resources/demo/README.md` for adding new templates
- PDF Preview mode in template editor
  - Toggle between HTML (Fast) and PDF (Actual) preview modes in editor header
  - **Live preview**: Shows PDF of current unsaved editor state, not just saved drafts
  - PdfPreview component sends current template model to backend for real-time rendering
  - Debounced fetching (500ms) to reduce API load during editing
  - Loading, error, and retry states with appropriate UI feedback
  - Blob URL management with proper cleanup to prevent memory leaks
  - HTML mode remains default for fast client-side rendering during editing
  - Backend preview endpoint now accepts optional `templateModel` in request body
- Single data example CRUD endpoints for independent example management
  - `PATCH /tenants/{tenantId}/templates/{id}/data-examples/{exampleId}` - Update a single example
  - `DELETE /tenants/{tenantId}/templates/{id}/data-examples/{exampleId}` - Delete a single example
  - Only validates the single example being updated (not all examples)
  - Supports `forceUpdate` flag to save despite validation warnings
  - Enables fixing/deleting invalid examples without affecting valid ones
  - Frontend editor now uses single-example endpoints for updates and deletes
- Data Contract Management in template editor
  - Visual schema editor with support for string, number, integer, boolean, array, and object types
  - Nested field support for object and array-of-object types (UI limits to one level; types support deeper nesting)
  - Array item type selector
  - Zod schema definitions for type safety and runtime validation
  - Required field toggle
  - "Generate from example" button to infer schema from test data
  - Advanced JSON toggle for direct JSON Schema editing
  - Tab-based UI with Schema and Test Data tabs
  - Expression path extraction from template blocks
  - Impact analysis to detect expressions not covered by schema
  - Frontend schema validation for test data examples
  - Backend schema validation during PDF generation (returns 400 with structured errors)
  - Schema persistence via template's dataModel field
  - Schema compatibility validation endpoint (`POST /validate-schema`)
  - Migration Assistant dialog showing compatibility issues with auto-fix suggestions
  - Type conversion for simple cases (string↔number, string↔boolean)
  - ValidationMessages component with separate error/warning display
  - DialogFooterActions component with unsaved changes indicator
- Data Examples Manager in template editor
  - Dropdown in editor header to select active test data example
  - Settings dialog to create, edit, and delete data examples
  - CodeMirror-based JSON editor for data editing
  - Auto-save to backend via PATCH API on save
  - Selected example automatically updates preview expression evaluation
  - Falls back to built-in default data when no examples exist
- PDF Preview button in versions table
  - Preview PDF button for Draft, Published, and Archived versions
  - Uses template's dataExamples for test data (first example or empty object)
  - Opens generated PDF in new browser tab
  - Loading state with visual feedback during PDF generation
- Expression language support (JSONata, JavaScript, SimplePath)
  - JSONata as the recommended language for template designers (concise, JSON-focused syntax)
  - JavaScript support for power users with full JS capabilities (array methods, etc.)
  - SimplePath for fast, safe path-only traversal (no operations, no code execution)
  - Expression language selection stored in Expression model
  - Server-side: JsonataEvaluator (dashjoin/jsonata), JavaScriptEvaluator (GraalJS sandbox), SimplePathEvaluator
  - Browser-side: JsonataEvaluator (jsonata npm), DirectEvaluator (Function)
  - CompositeExpressionEvaluator dispatches based on language field
  - Language toggle UI in expression editor popover
  - JSONata is now the default expression language
  - Comprehensive tests for all evaluators (JsonataEvaluatorTest, JavaScriptEvaluatorTest, SimplePathEvaluatorTest, CompositeExpressionEvaluatorTest)
- Server-side PDF generation using iText Core 9
  - New `modules/generation` module with DirectPdfRenderer for native PDF generation
  - New `modules/template-model` module with shared template types
  - Expression evaluation ({{customer.name}}) with path traversal and array support
  - TipTap JSON to iText conversion for rich text content
  - Block renderers: Text, Container, Columns, Table, Conditional, Loop
  - Style applicator supporting CSS-like properties (colors, margins, padding, fonts)
  - Preview endpoint: `POST /tenants/{tenantId}/templates/{id}/variants/{variantId}/preview`
  - Streaming PDF output to avoid memory buffering
- Template variants, versions, and lifecycle management (API-first)
  - New domain model: Template → Variant → Version with lifecycle states
  - Environments: Tenant-configurable deployment targets (staging, production, etc.)
  - Variants: Template presentation variations distinguished by free-form tags (locale, brand)
  - Versions: Immutable published versions with draft/published/archived lifecycle
  - Version numbering: Sequential assignment on publish, drafts have no version number
  - Environment activations: Configure which version is active per environment per variant
  - Database migration V3 with new tables: environments, template_variants, template_versions, environment_activations
  - OpenAPI endpoints for complete CRUD on environments, variants, versions, and lifecycle operations
  - API controller stubs ready for implementation
  - Note: Editor UI integration with versions is pending (TODO marked in code)
- Expression editor with CodeMirror integration and popover UI
  - Runtime type inference for autocomplete based on actual data values
  - Intelligent method suggestions for strings, arrays, numbers, and booleans
  - Method chaining support with proper return type tracking
  - Scope variable support for loop items and indices
  - Live preview of expression evaluation results
  - Body scroll lock when popover is open
- Comprehensive test suite for expression utilities (119 tests)
  - Vitest testing infrastructure with jsdom environment
  - Tests for type inference, path parsing, and completion source
  - Coverage reporting with v8 provider
- Unsaved changes detection in template editor
  - Visual indicator when template has unsaved changes
  - Warns users before leaving with unsaved work
- AutoSave component with debounced save and status indicator
  - Configurable debounce delay
  - Visual feedback for save state
- Resizable panel layout for editor components
  - Draggable dividers between canvas, preview, and sidebar
  - Persistent layout preferences
- Ctrl+S keyboard shortcut for saving templates
- shadcn/ui component library integration
  - Button, Popover, Tabs, Accordion, Dialog, Select, and more
  - Consistent design system across editor
- Prettier integration for code formatting
  - Format scripts in package.json (`format`, `format:check`)
  - ESLint configured to work alongside Prettier
- Inter font family for improved typography
- AnimateUI Switch component from shadcn

### Changed
- Refactored Data Contract Manager for better UX
  - Local-first draft state: edits are local until explicit save
  - Save & Stay Open pattern: dialog remains open after save with success feedback
  - Dirty state indicators on tabs showing unsaved changes
  - Close confirmation when there are unsaved changes
  - Force update option to save schema despite validation warnings
  - Replaced `alert()` calls with proper UI feedback components
- Redesigned template editor UI with shadcn components
  - BlockPalette with tabs and animations
  - StyleSidebar with improved organization and version display in footer
  - BlockStyleEditor with cleaner layout
  - Embedded toolbar with async save handling
  - BlockHeader extracted as reusable component with floating toolbar
  - Table config popup migrated to shadcn components
- Moved version display from global footer to editor sidebar for cleaner full-screen experience
- Removed embedded fonts to reduce CSS bundle size (~750KB savings)
- SaveButton refactored with useCallback optimization

### Fixed
- Schema-manager state management and schema-data synchronization
  - Fixed tab switching losing local changes by introducing shared draft state across tabs
  - Moved useDataContractDraft from individual sections to App.tsx for single source of truth
  - Fixed input focus loss in field name editor by replacing ref-based sync with useEffect
  - Implemented atomic schema-examples migration save (examples saved first, then schema)
  - Added dirty state indicators (●) on tabs when unsaved changes exist
  - Added "Save All Changes" button for one-click save of all changes
  - Added warning banner showing when unsaved changes are present
- SchemaEditor component using incorrect Zod imports (`uuidv4`, `ZodUUID`) that don't exist in Zod library
  - Replaced with proper `uuid` package imports for UUID generation
- Schema validation returning `compatible: true` on network/server errors in editor
  - Now correctly returns `compatible: false` with error message so UI can display failure
- MigrationAssistant dialog not updating selected migrations when `migrations` prop changes
  - Added useEffect to sync state when migrations are updated
- Data examples creation flow in template editor
  - Removed premature backend save when clicking "+" to add new example
  - Examples are now created locally first, allowing user to edit before save
  - Backend persistence only happens when user clicks "Save" with valid data
  - Fixes chicken-and-egg problem where empty data `{}` failed schema validation
- Radix UI package conflict causing infinite re-render loops in accordion with select components
- ColorPicker performance: added throttling to color area and commit-on-close pattern
- Color input width in ColorPicker component
- Unit input id placement for accessibility
- Added `pt` CSS unit support in style regex
- Corrected main.tsx path in index.html

### Added
- OpenAPI spec-driven API development infrastructure
  - New `modules/api-spec` module containing OpenAPI 3.1 YAML specifications
  - New `modules/api-server` module with generated Kotlin interfaces and DTOs (Jackson 3.x)
  - New `modules/api-client` module with generated client code (Jackson 2.x for consumer compatibility)
  - OpenAPI Generator 7.12.0 with `kotlin-spring` generator for server, `kotlin` for client
  - Redocly CLI for bundling modular specs, linting, and generating documentation
  - Static API documentation (Redoc) available at `/api-docs/` in the running application
  - Header-based API versioning using `application/vnd.epistola.v1+json` media type
  - Modular spec organization: `paths/` for endpoints, `components/schemas/` for models
  - Initial API spec covers Tenants and Templates CRUD operations
  - `V1ApiController` implementing generated `V1Api` interface using Mediator pattern
  - API endpoints available at `/api/v1/tenants` and `/api/v1/tenants/{tenantId}/templates`
  - Note: `api-spec` module will be extracted to a separate repository with its own release pipeline in the future
- Custom startup banner displaying application version, Spring Boot version, and Java version
  - ASCII art logo with version information printed on application startup
- Version display in UI footer across all pages
  - Fixed footer at bottom of all pages showing application name and version
  - Uses Spring Boot's BuildProperties for version information from build
  - Footer fragment (`fragments/footer.html`) included in all Thymeleaf templates
- Comprehensive product backlog with 58 GitHub issues organized by phase and domain
  - 4 milestones: MVP, Adoption, Enterprise, Governance
  - 11 domain labels for feature categorization (api, editor, generation, sdk, security, etc.)
  - 4 phase labels for release planning (mvp, adoption, enterprise, later)
  - 5 size labels for effort estimation (xs, s, m, l, xl)
- Public roadmap document (`docs/roadmap.md`) with development phases and technical decisions
- Updated project context (`openspec/project.md`) with tech stack, conventions, and domain model

### Changed
- Template content (templateModel) moved from DocumentTemplate to TemplateVersion
  - DocumentTemplate now only contains metadata: name, dataModel, dataExamples
  - Visual layout (templateModel) is stored in versions, enabling versioned content
  - CreateDocumentTemplate command now auto-creates default variant with draft version
- Unified tool version management with mise across local development and CI
  - Added Gradle 9.2.1 to `.mise.toml` for consistent version management
  - GitHub Actions workflows now use `jdx/mise-action@v2` instead of individual setup actions
  - Removed Gradle wrapper (`gradlew`, `gradlew.bat`, `gradle/wrapper/`) in favor of mise-managed Gradle
  - All documentation updated to use `gradle` command instead of `./gradlew`

### Fixed
- Security scan workflow failing due to non-existent Gradle task `:modules:editor:npmSbom`
  - Frontend SBOM is generated via npm, not Gradle
  - Workflow now runs npm commands directly in the editor module directory

### Added
- GitHub MCP server integration for AI-assisted issue and project management (`scripts/gh-mcp/`)
  - Cross-platform secure token storage using OS credential managers (macOS Keychain, Windows Credential Vault)
  - `pnpm run setup:github-mcp` script guides fine-grained PAT creation with minimal permissions
  - MCP wrapper script validates token availability before starting server
  - `.mcp.json` configuration for Claude Code integration (safe to commit, no secrets)
- GitHub Project configuration as code (`.github/project.yml`)
  - Declarative project field definitions synced via GitHub Actions workflow
  - Custom fields: Status (kanban), Priority (P0-P3), Size (XS-XL), Type, Target Date, Started At, Blocked Reason
  - Automatic project creation and field synchronization on config changes
  - GitHub App authentication for project management (fine-grained PATs don't support Projects v2)
  - Repository linking verified but not automated (requires admin; workflow fails with instructions if missing)

### Changed
- Separated frontend (pnpm) and backend (Gradle) build steps for simpler configuration
  - Frontend: `pnpm install && pnpm build` builds all modules in `modules/`
  - Backend: `gradle build` compiles, tests, and packages (requires frontend built first)
  - Gradle verifies frontend is built before packaging, failing with helpful error if not
  - Removed node-gradle plugin dependency for cleaner Gradle configuration
  - CI workflow updated to run pnpm build before Gradle with proper caching

### Added
- pnpm workspaces for frontend module management
  - Root `pnpm-workspace.yaml` orchestrates all modules in `modules/`
  - Unified dependency management and build commands from repo root
  - `pnpm build` builds all modules, `pnpm --filter @epistola/<module> build` for specific modules
- Import maps for shared JavaScript dependencies to avoid duplicate bundling
  - `modules/vendor` package uses Rollup to bundle React, ReactDOM, Zustand, and Immer as proper ESM with named exports
  - Custom entry wrappers ensure CJS packages export named bindings (not just default)
  - Editor module excludes shared dependencies via Vite externals (~750KB vs ~1.1MB bundle)
  - Thymeleaf import map fragment (`fragments/importmap.html`) for browser-native dependency resolution
  - Shared dependencies loaded once and cached, reducing page load time for multiple interactive components

### Changed
- Simplified template editor data passing by using Thymeleaf's native JavaScript serialization
  - Removed unnecessary JSON stringify/parse roundtrip in template handler
  - `templateModel` is now passed directly to the view and serialized by Thymeleaf

### Added
- Docker image build configuration with JVM and native options
  - JVM image (default): `gradle bootBuildImage`
  - Native image (disabled): `gradle bootBuildImage -PnativeImage=true` - broken due to JDBI/Kotlin reflection ([jdbi#2475](https://github.com/jdbi/jdbi/issues/2475))
  - Images signed with Cosign and SBOM attested
- CloudNativePG (CNPG) support in Helm chart for PostgreSQL database management
  - Three database modes: `cnpg` (create cluster), `cnpgExisting` (use existing), `external` (manual config)
  - New `database.type` configuration with discriminator pattern
  - Automatic CNPG Cluster resource creation when `database.type: cnpg`
  - Support for consuming existing CNPG cluster credentials
  - Backward compatibility with deprecated `postgresql.*` configuration
  - Post-install notes with cluster status and connection commands
- Extended document templates with data model and examples support
  - Renamed `content` column to `templateModel` (visual layout definition)
  - Added `dataModel` column for JSON Schema definitions
  - Added `dataExamples` column for named JSON examples that validate against the schema
  - JSON Schema validation using networknt/json-schema-validator 3.0.0 (Jackson 3 compatible)
  - `PATCH /tenants/{tenantId}/templates/{id}` endpoint for partial updates
  - Strict validation: examples must conform to schema, schema changes validate existing examples
- Form validation for tenant and template creation
  - Validation in command constructors using `require()` for fail-fast behavior
  - Name is required (non-blank) and max 255 characters
  - Inline error display below form fields using HTMX retarget/reswap
  - CSS styles for error states (red border, error message styling)
  - Form value preservation on validation error
- Testing documentation (`docs/testing.md`) covering test infrastructure, patterns, and best practices
  - Test framework overview (JUnit 5, Testcontainers, Spring Boot Test, AssertJ, Kover)
  - Guide to BaseIntegrationTest and TestFixture DSL usage
  - HTTP/route testing patterns including HTMX header handling
  - Testcontainers configuration and troubleshooting tips
- Command/Query Bus (Mediator pattern) for centralized message dispatching
  - `Command<R>` and `Query<R>` marker interfaces for type-safe message passing
  - `CommandHandler` and `QueryHandler` interfaces for handler implementations
  - `Mediator` interface with `send()` for commands and `query()` for queries
  - `SpringMediator` auto-discovers handlers via Spring's `ApplicationContext`
  - Decouples consumers from handlers enabling future cross-cutting concerns
- TestFixture Kotlin DSL for given-when-then style integration tests
  - Type-safe DSL with `@DslMarker` annotation to prevent scope leakage
  - `GivenContext` for test data setup with automatic cleanup
  - `WhenContext` for executing actions under test
  - `ThenContext` with `result<T>()` helper for type-safe result access
  - Automatic tenant cleanup after each test to ensure isolation
- Tenant management UI on homepage
  - Homepage (`/`) displays list of tenants with name and creation date
  - Form to create new tenants directly on the page
  - Search functionality to filter tenants by name
  - Each tenant links to their templates at `/tenants/{id}/templates`
  - Templates list shows breadcrumb navigation back to tenants
  - All template URLs are now tenant-scoped: `/tenants/{tenantId}/templates`
  - API endpoints are tenant-scoped: `/api/tenants/{tenantId}/templates/{id}`
- Multi-tenancy support for tenant isolation
  - New `Tenant` entity with `id`, `name`, and `createdAt` fields
  - `CreateTenant` and `DeleteTenant` commands for tenant management (internal use)
  - All `DocumentTemplate` records now belong to a tenant (required foreign key)
  - Tenant-scoped queries and commands prevent cross-tenant data access
  - Database migrations create `tenants` table and add `tenant_id` to `document_templates`
  - Default tenant (id=1) created for existing data during migration
  - Cascade delete: removing a tenant deletes all its templates
- Editor development modes for live reload
  - **Standalone mode** (`npm run dev`): Full Vite HMR for developing the editor in isolation
  - **Integrated mode** (`npm run watch`): Continuous builds for embedding in Thymeleaf pages
  - Editor module includes Kotlin/Spring auto-configuration
  - Vite watch auto-starts when `epistola.editor.dev-server.auto-start=true`
  - Spring Boot serves editor files from filesystem in `local` profile for fast iteration
  - Development workflow: run Spring Boot with `local` profile, editor rebuilds on file changes
- Editor component integration with Thymeleaf templates
    - Library build mode for the React editor (`mountEditor()` API)
    - Editor can be embedded in Thymeleaf pages while sharing the app layout
    - New `/templates/{id}/editor` route to open the visual template editor
    - REST API endpoints for saving template content (`PUT /api/templates/{id}`)
    - CSS isolation to prevent style conflicts between editor and parent page
    - Edit links added to the templates list page
- HTMX utilities for WebMvc.fn functional endpoints
  - `ServerRequest.isHtmx` extension property for detecting HTMX requests
  - `ServerRequest.render()` helper for HTMX-aware template rendering
  - `ServerRequest.htmx { }` Kotlin DSL for advanced responses:
    - Multiple fragments with Out-of-Band (OOB) swaps
    - Conditional rendering logic
    - Response headers: `trigger()`, `pushUrl()`, `reswap()`, `retarget()`
    - Non-HTMX fallback with `onNonHtmx { }`
  - `HxSwap` enum for all HTMX swap modes
  - Additional extensions: `htmxTrigger`, `htmxTarget`, `htmxBoosted`, etc.
- Automatic PR labeling based on changed files
  - Labels PRs with `backend`, `frontend`, `infrastructure`, or `documentation` based on file paths
  - Uses `actions/labeler@v5` with sync-labels to keep labels up-to-date
- Command-based architecture with JDBI for database access
  - Vertical slices: organize by feature (commands/, queries/) not by layer
  - JDBI 3.49.0 with Kotlin and Postgres plugins
  - Query handlers pattern for read operations
  - CreateDocumentTemplate command with handler for write operations
- Document Templates page with Thymeleaf rendering
  - New `/templates` endpoint displaying a table of document templates
  - Form to create new templates directly on the page (POST /templates)
  - Uses Spring WebMvc.fn functional endpoints (RouterFunction + Handler pattern)
  - Basic security configuration permitting public access to templates page
  - CSS styling for table and form components
  - Flyway migration for document_templates table

### Changed
- Migrated version management from asdf to mise for faster tool installation

- Updated documentation to reflect server-side rendering architecture (Thymeleaf + HTMX) instead of implying a Vite/TypeScript SPA frontend
  - CLAUDE.md: Added Frontend Architecture section, clarified project overview and structure
  - README.md: Added Architecture section, updated project description and modules
  - CONTRIBUTING.md: Added Thymeleaf + HTMX code style section, updated frontend label description
  - .github/labels.yml: Updated frontend label description

### Fixed
- Docker image now uses JDK 25 to match the build environment, fixing Kotlin reflection errors at runtime
- Labels sync workflow now works with private repositories by adding `contents: read` permission
- Docker image build in CI now explicitly sets image name to `epistola-suite` via `--imageName` flag to ensure consistent naming across build and push steps
- Helm chart security scan failures (AVD-KSV-0014, AVD-KSV-0118): added proper pod and container security contexts with `readOnlyRootFilesystem`, `seccompProfile`, `allowPrivilegeEscalation: false`, and capability drops

### Added
- Test coverage reporting using Kover with dynamic badge
  - Generates coverage reports via `gradle koverXmlReport`
  - Coverage badge updated automatically on main branch builds
  - Badge displayed in README alongside build and security badges
- Scheduled security scan workflow (daily) with dynamic vulnerability badge
  - Runs Trivy scans on SBOMs daily at 6 AM UTC
  - Updates badge in `.github/badges/trivy.json` showing vulnerability count
  - Automatically creates GitHub issue when critical vulnerabilities are detected
- README badges for CI build status, security scan, and AGPL-3.0 license
- Manual trigger for Helm chart workflow via `workflow_dispatch` with optional `force_release` input
- Docker image signing with Cosign (keyless OIDC)
  - All published images are cryptographically signed using Sigstore
  - SBOM attestation attached to images using CycloneDX format
  - Verify signatures: `cosign verify ghcr.io/epistola-app/epistola-suite:<tag> --certificate-identity-regexp='.*' --certificate-oidc-issuer='https://token.actions.githubusercontent.com'`
  - Verify SBOM attestation: `cosign verify-attestation ghcr.io/epistola-app/epistola-suite:<tag> --type cyclonedx --certificate-identity-regexp='.*' --certificate-oidc-issuer='https://token.actions.githubusercontent.com'`
- Helm chart for Kubernetes deployment
  - Published to OCI registry at `oci://ghcr.io/epistola-app/charts/epistola`
  - Separate versioning from the application using `chart-X.Y.Z` tags
  - Automatic version bumping based on conventional commits for changes in `charts/` directory
  - Includes: Deployment, Service, Ingress (optional), HPA (optional), ServiceAccount, ConfigMap
  - Trivy security scanning for Kubernetes misconfigurations
  - Spring Boot Actuator health probes (liveness/readiness) configured
- SBOM (Software Bill of Materials) generation using CycloneDX
  - Backend SBOM: `gradle :apps:epistola:generateSbom`
  - Frontend SBOM: `pnpm --filter @epistola/editor sbom`
  - Both SBOMs attached to GitHub Releases (`epistola-backend-{version}-sbom.json`, `epistola-editor-{version}-sbom.json`)
  - Backend SBOM embedded in Docker images at `META-INF/sbom/bom.json`
- Automatic vulnerability scanning using Trivy
  - Scans both backend and frontend SBOMs on every build
  - Fails build on critical vulnerabilities
  - Vulnerability reports uploaded as CI artifacts
- GitHub Releases are now created automatically with release notes and SBOM attachment
- Open source community infrastructure
  - CONTRIBUTING.md with development workflow, commit conventions, and code style guidelines
  - CODE_OF_CONDUCT.md based on Contributor Covenant v2.1
  - SECURITY.md with vulnerability reporting guidelines and 48-hour response SLA
  - GitHub issue templates (bug report, feature request, documentation)
  - Pull request template with checklist
  - Issue template config linking to GitHub Discussions for questions
  - Automated label management via GitHub Actions (`.github/labels.yml`)
  - Comprehensive GitHub documentation (`docs/github.md`) covering CI/CD, releases, labels, and workflows
  - CLAUDE.md with project-specific instructions for Claude Code AI assistant
  - Git hooks with commitlint for conventional commit validation
  - SSH commit signing auto-configuration in init script
- Initial project setup with Spring Boot 4.0.0 and Kotlin 2.3.0
- Multi-module Gradle structure with apps/epistola and modules/editor
- Vite-based editor module with TypeScript, embeddable in the Java application
- GitHub Actions CI/CD pipeline with build, test, and Docker image publishing to ghcr.io
- Automatic semantic versioning using github-tag-action based on conventional commits
- ktlint for consistent code style
- README with getting started guide using mise for version management
