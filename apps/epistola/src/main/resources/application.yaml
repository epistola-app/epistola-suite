server:
  port: 4000

spring:
  application:
    name: epistola-suite
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
  flyway:
    clean-disabled: false                # Allow Flyway to clean (required for Flyway 10+)
    locations:
      - classpath:db/migration
  web:
    resources:
      chain:
        strategy:
          content:
            enabled: true
            paths: /css/**, /design-system/**, /js/**, /editor/**
      cache:
        cachecontrol:
          max-age: 365d
          cache-public: true
  threads:
    virtual:
      enabled: true
  session:
    timeout: 4h  # Session timeout (frontend warns 5 min before expiry)
    jdbc:
      initialize-schema: never  # Managed by Flyway

# Note: OAuth2 configuration is in application-prod.yaml
# Local development uses form login (see application-local.yaml)
# Tests use permit-all (see application-test.yaml)

epistola:
  storage:
    backend: postgres
  auth:
    auto-provision: false
  demo:
    enabled: true  # Set to false to disable demo loading
  generation:
    polling:
      enabled: true              # Enable polling-based job execution
      interval-ms: 5000          # Fallback poll interval (drain loop handles active work)
      max-concurrent-jobs: 20    # Max jobs per instance (10x parallelism)
      stale-timeout-minutes: 10  # Reclaim jobs after 10 min of no progress
      adaptive-batch:
        min-batch-size: 1           # Never go below 1 (backward compatible)
        max-batch-size: 50          # Claim more per poll for efficient draining
        fast-threshold-ms: 2000     # < 2s avg = increase batch size
        slow-threshold-ms: 5000     # > 5s avg = decrease batch size
    async:
      concurrency: 10            # Items processed concurrently per job
    jobs:
      retention-days: 7          # Auto-delete completed jobs after 7 days
      cleanup-cron: "0 0 2 * * ?"  # Run cleanup at 2 AM daily
    documents:
      retention-days: 30         # Auto-delete documents after 30 days
      max-size-mb: 50            # Max document size

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true
      show-details: never
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true

