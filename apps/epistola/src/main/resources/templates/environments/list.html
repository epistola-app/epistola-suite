<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
    <th:block th:fragment="content">
        <div class="page-header">
            <h1>Environments</h1>
            <div class="page-actions">
                <div th:replace="~{fragments/search :: search-box(
                    placeholder='Search environments...',
                    searchUrl=@{/tenants/{tenantId}/environments/search(tenantId=${tenantId})},
                    targetId='environment-rows'
                )}"></div>
                <a th:href="@{/tenants/{tenantId}/environments/new(tenantId=${tenantId})}" class="btn btn-primary">
                    <th:block th:replace="~{fragments/icon :: icon(name='plus', class='ep-icon')}" />
                    New Environment
                </a>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(environments)}" class="empty-state">
            <div class="empty-state-icon">
                <th:block th:replace="~{fragments/icon :: icon(name='globe', class='ep-icon ep-icon-xl')}" />
            </div>
            <div class="empty-state-title">No environments yet</div>
            <div class="empty-state-description">Create environments to control where template versions are deployed.</div>
            <a th:href="@{/tenants/{tenantId}/environments/new(tenantId=${tenantId})}" class="btn btn-primary" style="margin-top: var(--ep-space-4);">
                <th:block th:replace="~{fragments/icon :: icon(name='plus', class='ep-icon')}" />
                New Environment
            </a>
        </div>

        <table th:if="${!#lists.isEmpty(environments)}" class="ep-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>ID</th>
                    <th>Created</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="environment-rows">
                <th:block th:fragment="rows">
                    <tr th:each="env : ${environments}">
                        <td style="font-weight: 500;" th:text="${env.name}"></td>
                        <td><code th:text="${env.id}" style="font-size: var(--ep-text-xs); color: var(--ep-muted-foreground);"></code></td>
                        <td th:text="${#temporals.format(env.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                        <td class="actions">
                            <form th:hx-post="@{/tenants/{tenantId}/environments/{environmentId}/delete(tenantId=${tenantId},environmentId=${env.id})}"
                                  hx-target="#environment-rows"
                                  hx-swap="innerHTML"
                                  hx-confirm="Delete this environment? Any active template versions deployed to it will need to be redeployed elsewhere."
                                  style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-icon btn-ghost btn-ghost-destructive" title="Delete environment">
                                    <th:block th:replace="~{fragments/icon :: icon(name='trash-2', class='ep-icon ep-icon-sm')}" />
                                </button>
                            </form>
                        </td>
                    </tr>
                </th:block>
            </tbody>
        </table>
    </th:block>
</body>
</html>
