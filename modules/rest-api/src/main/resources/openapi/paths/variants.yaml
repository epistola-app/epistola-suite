variants:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique identifier of the tenant
      schema:
        type: string
        format: uuid
    - name: templateId
      in: path
      required: true
      description: Unique identifier of the template
      schema:
        type: string
        format: uuid

  get:
    operationId: listVariants
    summary: List variants for a template
    description: Retrieve all variants of a specific template.
    tags:
      - Variants
    responses:
      '200':
        description: List of variants
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/variants.yaml#/VariantListResponse'
      '404':
        description: Template or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  post:
    operationId: createVariant
    summary: Create a new variant
    description: Create a new variant for the specified template with optional tags.
    tags:
      - Variants
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/variants.yaml#/CreateVariantRequest'
    responses:
      '201':
        description: Variant created successfully
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/variants.yaml#/VariantDto'
      '400':
        description: Invalid request
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '404':
        description: Template or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

variants-id:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique identifier of the tenant
      schema:
        type: string
        format: uuid
    - name: templateId
      in: path
      required: true
      description: Unique identifier of the template
      schema:
        type: string
        format: uuid
    - name: variantId
      in: path
      required: true
      description: Unique identifier of the variant
      schema:
        type: string
        format: uuid

  get:
    operationId: getVariant
    summary: Get variant by ID
    description: Retrieve details of a specific variant including version summary.
    tags:
      - Variants
    responses:
      '200':
        description: Variant details
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/variants.yaml#/VariantDto'
      '404':
        description: Variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  patch:
    operationId: updateVariant
    summary: Update a variant
    description: Update a variant's tags.
    tags:
      - Variants
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/variants.yaml#/UpdateVariantRequest'
    responses:
      '200':
        description: Variant updated successfully
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/variants.yaml#/VariantDto'
      '400':
        description: Invalid request
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '404':
        description: Variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  delete:
    operationId: deleteVariant
    summary: Delete a variant
    description: Delete a variant and all its versions.
    tags:
      - Variants
    responses:
      '204':
        description: Variant deleted successfully
      '404':
        description: Variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

variant-draft:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique identifier of the tenant
      schema:
        type: string
        format: uuid
    - name: templateId
      in: path
      required: true
      description: Unique identifier of the template
      schema:
        type: string
        format: uuid
    - name: variantId
      in: path
      required: true
      description: Unique identifier of the variant
      schema:
        type: string
        format: uuid

  get:
    operationId: getVariantDraft
    summary: Get current draft
    description: Retrieve the current draft version for a variant.
    tags:
      - Variants
    responses:
      '200':
        description: Draft version
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '404':
        description: Draft, variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  put:
    operationId: upsertVariantDraft
    summary: Create or update draft
    description: Create a new draft or update the existing draft for a variant.
    tags:
      - Variants
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/versions.yaml#/UpdateDraftRequest'
    responses:
      '200':
        description: Draft updated
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '201':
        description: Draft created
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '400':
        description: Invalid request
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '404':
        description: Variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

variant-activations:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique identifier of the tenant
      schema:
        type: string
        format: uuid
    - name: templateId
      in: path
      required: true
      description: Unique identifier of the template
      schema:
        type: string
        format: uuid
    - name: variantId
      in: path
      required: true
      description: Unique identifier of the variant
      schema:
        type: string
        format: uuid

  get:
    operationId: listVariantActivations
    summary: List environment activations
    description: List which version is active in each environment for this variant.
    tags:
      - Variants
    responses:
      '200':
        description: List of activations
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/variants.yaml#/ActivationListResponse'
      '404':
        description: Variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

variant-activation-env:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique identifier of the tenant
      schema:
        type: string
        format: uuid
    - name: templateId
      in: path
      required: true
      description: Unique identifier of the template
      schema:
        type: string
        format: uuid
    - name: variantId
      in: path
      required: true
      description: Unique identifier of the variant
      schema:
        type: string
        format: uuid
    - name: environmentId
      in: path
      required: true
      description: Unique identifier of the environment
      schema:
        type: string
        format: uuid

  put:
    operationId: setVariantActivation
    summary: Set active version for environment
    description: Set which published version is active for this variant in the specified environment.
    tags:
      - Variants
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/variants.yaml#/SetActivationRequest'
    responses:
      '200':
        description: Activation set successfully
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/variants.yaml#/ActivationDto'
      '400':
        description: Invalid request (version not published)
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '404':
        description: Variant, template, environment, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  delete:
    operationId: removeVariantActivation
    summary: Remove activation for environment
    description: Remove the active version for this variant in the specified environment.
    tags:
      - Variants
    responses:
      '204':
        description: Activation removed successfully
      '404':
        description: Activation, variant, template, environment, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

variant-active:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique identifier of the tenant
      schema:
        type: string
        format: uuid
    - name: templateId
      in: path
      required: true
      description: Unique identifier of the template
      schema:
        type: string
        format: uuid
    - name: variantId
      in: path
      required: true
      description: Unique identifier of the variant
      schema:
        type: string
        format: uuid

  get:
    operationId: getActiveVersion
    summary: Get active version for environment
    description: Retrieve the active published version for this variant in the specified environment.
    tags:
      - Variants
    parameters:
      - name: environment
        in: query
        required: true
        description: Environment ID to get active version for
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Active version
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '404':
        description: No active version, variant, template, environment, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'
